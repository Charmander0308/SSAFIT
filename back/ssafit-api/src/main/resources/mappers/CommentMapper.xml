<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafit.comment.dao.CommentDao">
	<select id="selectCommentByDomain" parameterType="Map" resultType="CommentResponseDto">
		select
			c.*,
			m.nickname,
			m.profile_img_directory as profileImg
		from comment c join member m
			on c.member_id = m.id
		<where>
			<choose>	
				<when test="domain == 'community'">
					and community_id = #{id}
				</when>
				<when test="domain == 'youtubeVideo'">
					and youtube_video_id = #{id}
				</when>
				<when test="domain == 'member'">
					and member_id = #{id}
				</when>
				<otherwise>
					and 1 = 0
				</otherwise>
			</choose>
		</where>
	</select>
	
	<select id="commentCnt" parameterType="map" resultType="Integer">
		select count(*)
		from comment
		<where>
			<choose>	
				<when test="domain == 'community'">
					and community_id = #{id}
				</when>
				<when test="domain == 'youtubeVideo'">
					and youtube_video_id = #{id}
				</when>
				<when test="domain == 'member'">
					and member_id = #{id}
				</when>
				<otherwise>
					and 1 = 0
				</otherwise>
			</choose>
		</where>
	</select>
	
	<select id="selectComment" parameterType="CommentRequestDto" resultType="CommentResponseDto">
		select *
		from comment
		where community_id = #{communityId}
		and member_id = #{memberId};
	</select>
	
	<insert id="insertComment" parameterType="CommentRequestDto">
		insert into comment (content, upload_date, community_id, youtube_video_id, member_id)
		values (#{content}, now(), #{communityId}, #{youtubeVideoId}, #{memberId});
	</insert>
</mapper>